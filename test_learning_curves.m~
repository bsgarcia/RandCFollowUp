% --------------------------------------------------------------------
init;

%------------------------------------------------------------------------
% Plot fig
%------------------------------------------------------------------------
selected_exp = [1, 2, 3, 4, 5.1, 5.2, 6.1, 6.2, 7.1, 7.2];

displayfig = 'on';
sessions = [0, 1];
nagent = 10;

for exp_num = selected_exp
    
    clear sim_corr
    clear bhv_corr 
    
    idx1 = (exp_num - round(exp_num)) * 10;
    if idx1 == 0
        idx1 = 1;
    end
    sess = sessions(uint64(idx1));
    
    % load data
    exp_name = char(filenames{round(exp_num)});
    
    data = d.(exp_name).data;
    sub_ids = d.(exp_name).sub_ids;
    
    [cho, cfcho, out, cfout, corr1, con1, p1, p2, rew, rtime, ev1, ev2,...
                error_exclude] = ...
                DataExtraction.extract_learning_data(data, sub_ids, idx, sess);
    
    [corr2, cho, out, con2, p1, p2, ev1, ev2, Q] = ...
        sim_exp_learning(exp_name, exp_num, d, idx, sess, nagent);
    
    
   for isub = 1:d.(exp_name).nsub
        
        for icond = 1:4
            
             dd1 = corr1(isub, (con1(isub, :) == icond));
%             dd1 = corr1(isub, :);
%             dd2 = corr2(isub, :);
            
            for t = 1:30
%                 bhv_corr(t) = mean(dd1(:,t))         
%                 sim_corr(isub, t) = dd2(t);
                bhv_corr(icond, isub, t) = dd1(t);
               
            end
            
        end
   end
   
   for isub = 1:size(corr2, 1)
        
        for icond = 1:4
             
             dd2 = corr2(isub, (con2(isub, :) == icond));
             
                 
             end
%             dd1 = corr1(isub, :);
%             dd2 = corr2(isub, :);
            
            for t = 1:30
%                 bhv_corr(t) = mean(dd1(:,t))         
%                 sim_corr(isub, t) = dd2(t);
                sim_corr(icond, isub, t) = dd2(t);
               
            end
            
        end
   end
    
    figure('Position', [0, 0, 1000, 600]);
    %alphas = fliplr(linspace(0.2, 0.9, 4));
    titles = {'90/10', '80/20', '70/30', '60/40'};
        
    %dd1 = reshape(bhv_corr(icond, :, :), [30, size(bhv_corr(icond, :, :), 3)]);
    %dd2 = reshape(sim_corr(icond, :, :), [30, size(sim_corr(icond, :, :), 3)]);
    dd1 = reshape(mean(bhv_corr, 1), [d.(exp_name).nsub, 30]);
    dd2 = reshape(mean(sim_corr, 1), [size(corr2, 1), 30]);
    
    mn = mean(dd1);
    err = std(dd1)./sqrt(size(dd1, 1));
    
    sc1 = scatter(1:30, mn, 180,...
        'MarkerEdgeColor', 'w',...
        'MarkerFaceColor', blue_color, 'MarkerFaceAlpha', 0.7);
    
    hold on
    errorbar(sc1.XData, mn, err, 'Color', blue_color,... %'Alpha', alphas(i),...
        'LineStyle', 'none', 'LineWidth', 1.7);%, 'CapSize', 2);
    hold on
    
    surfaceplot(dd2', 0.5 .* ones(3, 1), blue_color, 1,  0.2,...
        -0.08 , 1.08, 20, '', 'Trials', 'Correct choice rate');
    hold on
  
    title(sprintf('Exp. %s', num2str(exp_num)));
     mkdir('fig/exp', 'learning_curves');
    saveas(gcf, ...
        sprintf('fig/exp/learning_curves/exp_%s.png',...
        num2str(exp_num)));
    clear bhv_corr sim_corr dd1 dd2 corr1 corr2
    
end

% i = 1;
% sub = 1;
% nsub = 0;

% for exp_name = {filenames{:}}
% 
%     session = 0;
%    
%     exp_name = char(exp_name);
%     nsub = nsub + d.(exp_name).nsub;
%    
%     [cho, out, cfout, corr1, con, p1, p2, rew, rtime] = ...
%         DataExtraction.extract_learning_data(...
%         d.(exp_name).data, d.(exp_name).sub_ids, idx, session);
%    
%     for isub = 1:d.(exp_name).nsub
%         for icond = 1:4
%             dd = corr1(isub, (con(isub, :) == icond));
%             for t = 1:30
%                 new_corr(icond, t, sub) = dd(t);
%             end
%            
%         end
%         sub = sub + 1;
%     end
%    
%    
%     i = i + 1;
% end

