%-------------------------------------------------------------------------
init;
%-------------------------------------------------------------------------
close all

selected_exp = [1];
ntrial = 30;

for exp_num = selected_exp
    
    data = de.extract_LE(exp_num);
    data.out = data.out==1;
    data.cfout = data.cfout==1;
    
    out = nan(data.nsub, 4);
    p = unique(data.p1);
    p = sort([p; unique(data.p2)]);
    for sub = 1:data.nsub
        for i = 1:length(p)
            mask_out = logical(...
            (data.cho(sub, :)==1).*(data.p1(sub,:)==p(i)) + (data.cho(sub, :)==2).*(data.p2(sub,:)==p(i)));
            mask_cfout = logical(...
            (data.cho(sub, :)==2).*(data.p1(sub,:)==p(i)) + (data.cho(sub, :)==1).*(data.p2(sub,:)==p(i)));
            out = data.out(sub, mask_out)';
            cfout = data.cfout(sub, mask_cfout)';
            o = [out(1:30); cfout(1:30)];
            %data.cfout(sub, mask_cfout)'
            var(sub, i) = mean(o...
                , 'all') .* 100;
        end
    end
end

brickplot(var',blue.*ones(4, 1), [-10, 110], 12, '', 'E-option p(win) (%)','Empirical p(win) (%)', p.*100, 0, [-10, 110], p.*100, 3, 0)
plot(0:10:100, 0:10:100, 'linestyle', '--', 'color', 'k')
yticks(0:10:100)